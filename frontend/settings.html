<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - EchoWatch</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .nav-link.active {
      background-color: #374151;
      /* bg-gray-700 */
      color: #22d3ee;
      /* text-cyan-400 */
    }

    /* Styles for the modal and toast */
    .modal-overlay {
      transition: opacity 0.2s ease-in-out;
    }

    .toast-notification {
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    }
  </style>
</head>

<body class="bg-gray-900 text-gray-100">

  <!-- Navbar -->
  <nav class="bg-gray-800/80 backdrop-blur-md shadow-lg sticky top-0 z-40 border-b border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center">
          <svg class="h-8 w-8 text-cyan-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd"
              d="M12.516 2.17a.75.75 0 00-1.032 0L3.32 9.25a.75.75 0 00.516 1.28h.171l.527 4.903a.75.75 0 00.742.667h8.498a.75.75 0 00.742-.667l.527-4.903h.171a.75.75 0 00.516-1.28L12.516 2.17zM11.25 16.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
              clip-rule="evenodd" />
            <path
              d="M21.75 9.25a.75.75 0 00-1.032-.019l-8.47 7.058a.75.75 0 00-.336.618V19.5a.75.75 0 00.75.75h8.25a.75.75 0 00.75-.75v-9.142a.75.75 0 00-.218-.508z" />
          </svg>
          <span class="ml-2 text-2xl font-bold text-white">Echo<span
              class="font-light text-cyan-400">Watch</span></span>
        </a>
        <div>
          <a href="dashboard.html"
            class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
          <a href="settings.html"
            class="text-cyan-400 bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">Settings</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="mb-8">
      <h1 class="text-3xl font-bold tracking-tight text-white">Settings</h1>
      <p class="mt-1 text-gray-400">Manage your cameras, alerts, and account preferences.</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <!-- Sidebar Navigation -->
      <aside class="md:col-span-1">
        <nav class="space-y-1">
          <a href="#" data-target="panel-cameras"
            class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">Camera Management</a>
          <a href="#" data-target="panel-alerts"
            class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">Alert Configuration</a>
          <a href="#" data-target="panel-notifications"
            class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">Notifications</a>
          <a href="#" data-target="panel-account"
            class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">Account</a>
        </nav>
      </aside>

      <!-- Settings Panels -->
      <main class="md:col-span-3">
        <!-- Camera Management Panel -->
        <div id="panel-cameras" class="settings-panel bg-gray-800 rounded-xl border border-gray-700 p-6">
          <h2 class="text-xl font-semibold mb-4 text-white">Camera Management</h2>
          <div class="space-y-6">
            <div>
              <label for="camera-count" class="block text-sm font-medium text-gray-300 mb-1">Number of Cameras</label>
              <input type="number" name="camera-count" id="camera-count"
                class="block w-24 bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500"
                readonly>
            </div>
            <div class="border-t border-gray-700 pt-6">
              <h3 class="text-lg font-medium text-white mb-4">Connected Cameras</h3>
              <div id="camera-list-container" class="space-y-4">
                <!-- Camera items will be dynamically inserted here -->
              </div>
              <button id="add-camera-btn"
                class="mt-6 px-4 py-2 bg-cyan-500 text-white font-semibold rounded-lg shadow-md hover:bg-cyan-600">Add
                New Camera</button>
            </div>
          </div>
        </div>
        <!-- Other Panels... -->
        <div id="panel-alerts" class="settings-panel hidden bg-gray-800 rounded-xl border border-gray-700 p-6">
          <h2 class="text-xl font-semibold mb-4 text-white">Alert Configuration</h2>
          <div class="space-y-4">
            <div class="flex items-center justify-between"><span class="text-gray-300">Enable Loitering
                Alerts</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                  id="alert-loitering" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between"><span class="text-gray-300">Enable Concealed Threat
                Alerts</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                  id="alert-threat" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600">
                </div>
              </label></div>
            <div class="flex items-center justify-between"><span class="text-gray-300">Enable Restricted Zone
                Alerts</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox"
                  id="alert-zone" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600">
                </div>
              </label></div>
          </div>
        </div>
        <div id="panel-notifications" class="settings-panel hidden bg-gray-800 rounded-xl border border-gray-700 p-6">
          <h2 class="text-xl font-semibold mb-4 text-white">Notifications</h2>
          <div class="space-y-6">
            <div><label for="notification-email" class="block text-sm font-medium text-gray-300 mb-1">Notification
                Email</label><input type="email" name="email" id="notification-email"
                class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500">
            </div>
            <div class="flex items-center justify-between"><span class="text-gray-300">Enable Email
                Notifications</span><label class="relative inline-flex items-center cursor-pointer"><input
                  type="checkbox" id="notification-toggle" class="sr-only peer">
                <div
                  class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600">
                </div>
              </label></div>
          </div>
        </div>
        <div id="panel-account" class="settings-panel hidden bg-gray-800 rounded-xl border border-gray-700 p-6">
          <h2 class="text-xl font-semibold mb-4 text-white">Account</h2>
          <div class="space-y-6">
            <div><label for="account-username"
                class="block text-sm font-medium text-gray-300 mb-1">Username</label><input type="text" name="username"
                id="account-username"
                class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500">
            </div>
            <div><label for="account-password" class="block text-sm font-medium text-gray-300 mb-1">New
                Password</label><input type="password" name="password" id="account-password"
                placeholder="Leave blank to keep current password"
                class="block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500">
            </div>
          </div>
        </div>

        <div class="mt-6 flex justify-end">
          <button id="save-changes-btn" type="button"
            class="px-6 py-2 bg-cyan-500 text-white font-semibold rounded-lg shadow-md hover:bg-cyan-600">Save
            Changes</button>
        </div>
      </main>
    </div>
  </div>

  <!-- Add Camera Modal -->
  <div id="add-camera-modal"
    class="modal-overlay fixed inset-0 z-50 bg-black/60 hidden items-center justify-center p-4">
    <div class="bg-gray-800 rounded-xl shadow-lg w-full max-w-md p-6">
      <h2 class="text-xl font-semibold text-white mb-4">Add a New Camera</h2>
      <form id="camera-form">
        <div class="space-y-4">
          <div>
            <label for="new-camera-name" class="block text-sm font-medium text-gray-300">Camera Name</label>
            <input type="text" id="new-camera-name" placeholder="e.g., Lobby Entrance" required
              class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500">
          </div>
          <div>
            <label for="new-camera-ip" class="block text-sm font-medium text-gray-300">IP Address or Stream URL</label>
            <input type="text" id="new-camera-ip" placeholder="e.g., 192.168.1.103" required
              class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500">
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button type="button" id="cancel-modal-btn"
            class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-500">Cancel</button>
          <button type="submit"
            class="px-4 py-2 bg-cyan-500 text-white font-semibold rounded-lg shadow-md hover:bg-cyan-600">Add
            Camera</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast-notification"
    class="toast-notification fixed bottom-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-2 hidden">
    Settings saved successfully!
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- DOM ELEMENT SELECTORS ---
      const navLinks = document.querySelectorAll('.nav-link');
      const settingsPanels = document.querySelectorAll('.settings-panel');
      const cameraListContainer = document.getElementById('camera-list-container');
      const cameraCountInput = document.getElementById('camera-count');
      const addCameraBtn = document.getElementById('add-camera-btn');
      const saveChangesBtn = document.getElementById('save-changes-btn');
      const toast = document.getElementById('toast-notification');

      // Modal elements
      const modal = document.getElementById('add-camera-modal');
      const cancelModalBtn = document.getElementById('cancel-modal-btn');
      const cameraForm = document.getElementById('camera-form');
      const newCameraNameInput = document.getElementById('new-camera-name');
      const newCameraIpInput = document.getElementById('new-camera-ip');

      // --- STATE MANAGEMENT ---
      let settings = {};
      const localStorageKey = 'echoWatchSettings';

      const defaultSettings = {
        cameras: [
          { name: 'Entrance A', ip: '192.168.1.101' },
          { name: 'Corridor B', ip: '192.168.1.102' }
        ],
        alerts: {
          loitering: true,
          threat: true,
          zone: false,
        },
        notifications: {
          email: 'security-team@example.com',
          enabled: true
        },
        account: {
          username: 'AdminUser'
        }
      };

      // --- FUNCTIONS ---

      // Function to render the list of cameras
      const renderCameras = () => {
        cameraListContainer.innerHTML = ''; // Clear existing list
        settings.cameras.forEach((camera, index) => {
          const cameraElement = document.createElement('div');
          cameraElement.className = 'flex items-center justify-between p-3 bg-gray-700/50 rounded-lg';
          cameraElement.innerHTML = `
            <input type="text" value="${camera.name}" data-index="${index}" class="camera-name-input bg-transparent text-white w-full focus:outline-none focus:ring-1 focus:ring-cyan-500 rounded px-1">
            <span class="text-xs font-mono text-gray-400 mr-4">${camera.ip}</span>
            <button data-index="${index}" class="remove-camera-btn text-red-400 hover:text-red-600 text-sm">Remove</button>
          `;
          cameraListContainer.appendChild(cameraElement);
        });
        cameraCountInput.value = settings.cameras.length;
      };

      // Function to render all settings to the UI
      const renderAllSettings = () => {
        // Render cameras
        renderCameras();
        // Render alerts
        document.getElementById('alert-loitering').checked = settings.alerts.loitering;
        document.getElementById('alert-threat').checked = settings.alerts.threat;
        document.getElementById('alert-zone').checked = settings.alerts.zone;
        // Render notifications
        document.getElementById('notification-email').value = settings.notifications.email;
        document.getElementById('notification-toggle').checked = settings.notifications.enabled;
        // Render account
        document.getElementById('account-username').value = settings.account.username;
      };

      // Load settings from localStorage or use defaults
      const loadSettings = () => {
        const savedSettings = localStorage.getItem(localStorageKey);
        settings = savedSettings ? JSON.parse(savedSettings) : defaultSettings;
        renderAllSettings();
      };

      // Save all current settings from UI to localStorage
      const saveSettings = () => {
        // Gather camera names from inputs
        document.querySelectorAll('.camera-name-input').forEach(input => {
          const index = input.getAttribute('data-index');
          settings.cameras[index].name = input.value;
        });

        // Gather other settings
        settings.alerts.loitering = document.getElementById('alert-loitering').checked;
        settings.alerts.threat = document.getElementById('alert-threat').checked;
        settings.alerts.zone = document.getElementById('alert-zone').checked;
        settings.notifications.email = document.getElementById('notification-email').value;
        settings.notifications.enabled = document.getElementById('notification-toggle').checked;
        settings.account.username = document.getElementById('account-username').value;
        // Note: We don't save the password for security reasons

        localStorage.setItem(localStorageKey, JSON.stringify(settings));
        showToast();
      };

      const showToast = () => {
        toast.classList.remove('hidden');
        setTimeout(() => {
          toast.classList.remove('opacity-0', 'translate-y-2');
        }, 10); // small delay to allow display change
        setTimeout(() => {
          toast.classList.add('opacity-0', 'translate-y-2');
          setTimeout(() => toast.classList.add('hidden'), 300);
        }, 3000); // hide after 3 seconds
      };

      // --- EVENT LISTENERS ---

      // Tab navigation
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('data-target');
          navLinks.forEach(nav => nav.classList.remove('active'));
          link.classList.add('active');
          settingsPanels.forEach(panel => {
            panel.id === targetId ? panel.classList.remove('hidden') : panel.classList.add('hidden');
          });
        });
      });
      // Set first tab active on load
      navLinks[0].classList.add('active');
      settingsPanels[0].classList.remove('hidden');


      // Modal listeners
      addCameraBtn.addEventListener('click', () => modal.classList.remove('hidden'));
      cancelModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.add('hidden');
      });

      // Form submission for new camera
      cameraForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newCamera = {
          name: newCameraNameInput.value,
          ip: newCameraIpInput.value
        };
        settings.cameras.push(newCamera);
        renderCameras(); // Re-render the camera list
        modal.classList.add('hidden'); // Hide modal
        cameraForm.reset(); // Reset form fields
      });

      // Listener for removing a camera (using event delegation)
      cameraListContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-camera-btn')) {
          const indexToRemove = parseInt(e.target.getAttribute('data-index'));
          settings.cameras.splice(indexToRemove, 1); // Remove from array
          renderCameras(); // Re-render the list
        }
      });

      // Save changes button
      saveChangesBtn.addEventListener('click', saveSettings);

      // --- INITIALIZATION ---
      loadSettings();
    });
  </script>

</body>

</html>